<div class="product-dialog">
  <h2 mat-dialog-title>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h2>
  
  <mat-dialog-content>
    <form [formGroup]="productForm" class="product-form">
      <!-- Image Upload Section -->
      <div class="image-upload-section">
        <div class="image-preview" *ngIf="imagePreview">
          <img [src]="imagePreview" alt="Product preview">
          <button mat-icon-button class="remove-image" (click)="removeImage()" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="upload-area" *ngIf="!imagePreview">
          <mat-icon>cloud_upload</mat-icon>
          <p>Click to upload product image</p>
        </div>
        
        <input type="file" 
               #fileInput 
               (change)="onFileSelected($event)" 
               accept="image/*" 
               style="display: none;">
        
        <button mat-stroked-button 
                type="button" 
                (click)="fileInput.click()"
                class="upload-button">
          <mat-icon>add_photo_alternate</mat-icon>
          {{ imagePreview ? 'Change Image' : 'Upload Image' }}
        </button>
      </div>

      <!-- Product Details -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Product Name</mat-label>
          <input matInput formControlName="name" required>
          <mat-error *ngIf="productForm.get('name')?.hasError('required')">
            Product name is required
          </mat-error>
          <mat-error *ngIf="productForm.get('name')?.hasError('minlength')">
            Name must be at least 2 characters
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput 
                    formControlName="description" 
                    rows="4" 
                    required
                    placeholder="Enter product description..."></textarea>
          <mat-error *ngIf="productForm.get('description')?.hasError('required')">
            Description is required
          </mat-error>
          <mat-error *ngIf="productForm.get('description')?.hasError('minlength')">
            Description must be at least 10 characters
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row two-columns">
        <mat-form-field appearance="outline">
          <mat-label>Price (â‚¹)</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="price" 
                 min="0" 
                 step="0.01" 
                 required>
          <mat-error *ngIf="productForm.get('price')?.hasError('required')">
            Price is required
          </mat-error>
          <mat-error *ngIf="productForm.get('price')?.hasError('min')">
            Price must be greater than 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Stock Quantity</mat-label>
          <input matInput 
                 type="number" 
                 formControlName="stock" 
                 min="0" 
                 required>
          <mat-error *ngIf="productForm.get('stock')?.hasError('required')">
            Stock quantity is required
          </mat-error>
          <mat-error *ngIf="productForm.get('stock')?.hasError('min')">
            Stock cannot be negative
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Category</mat-label>
          <mat-select formControlName="categoryId" required>
            <mat-option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productForm.get('categoryId')?.hasError('required')">
            Please select a category
          </mat-error>
        </mat-form-field>
      </div>

      <div class="checkbox-section">
        <mat-checkbox formControlName="isActive">
          Active Product
        </mat-checkbox>
        
        <mat-checkbox formControlName="isFeatured">
          Featured Product
        </mat-checkbox>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="loading">
      Cancel
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSubmit()" 
            [disabled]="productForm.invalid || loading">
      <span *ngIf="loading">{{ isEditMode ? 'Updating...' : 'Creating...' }}</span>
      <span *ngIf="!loading">{{ isEditMode ? 'Update Product' : 'Create Product' }}</span>
    </button>
  </mat-dialog-actions>
</div>