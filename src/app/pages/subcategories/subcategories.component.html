<div class="subcategories-container">
  <div class="header-section">
    <div class="title-section">
      <h1>Subcategories</h1>
      <p>Manage product subcategories and their organization</p>
    </div>
    <button 
      pButton 
      type="button" 
      label="Add Subcategory" 
      icon="pi pi-plus" 
      class="p-button-primary"
      (click)="openAddDialog()">
    </button>
  </div>

  <!-- Filters Section -->
  <p-card class="filters-card">
    <div class="filters-row">
      <div class="filter-group">
        <label for="search">Search</label>
        <input 
          type="text" 
          id="search"
          pInputText 
          placeholder="Search subcategories..." 
          [(ngModel)]="searchTerm"
          (input)="applyFilter()"
          class="search-input">
      </div>
      
      <div class="filter-group">
        <label for="category">Category</label>
        <p-select 
          id="category"
          [options]="categories" 
          optionLabel="name" 
          optionValue="id"
          placeholder="All Categories"
          [(ngModel)]="selectedCategoryId"
          (onChange)="onCategoryChange()"
          [showClear]="true">
        </p-select>
      </div>
      
      <div class="filter-group">
        <label for="status">Status</label>
        <p-select 
          id="status"
          [options]="statusOptions" 
          optionLabel="label" 
          optionValue="value"
          placeholder="All Status"
          [(ngModel)]="selectedStatus"
          (onChange)="onStatusChange()">
        </p-select>
      </div>
    </div>
  </p-card>

  <!-- Subcategories Table -->
  <p-card class="table-card">
    <div class="table-container">
      <p-table 
        [value]="filteredSubcategories" 
        [loading]="loading"
        [paginator]="true" 
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} subcategories"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-sm">
        
        <ng-template pTemplate="header">
          <tr>
            <th>Image</th>
            <th pSortableColumn="name">
              Name 
              <p-sortIcon field="name"></p-sortIcon>
            </th>
            <th>Description</th>
            <th>Category</th>
            <th pSortableColumn="isActive">
              Status 
              <p-sortIcon field="isActive"></p-sortIcon>
            </th>
            <th>Actions</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-subcategory>
          <tr>
            <td>
              <div class="image-cell">
                <img 
                  *ngIf="subcategory.imageUrl" 
                  [src]="subcategory.imageUrl" 
                  [alt]="subcategory.name"
                  class="subcategory-image">
                <div 
                  *ngIf="!subcategory.imageUrl" 
                  class="no-image">
                  <i class="pi pi-image"></i>
                </div>
              </div>
            </td>
            <td>
              <div class="name-cell">
                <strong>{{ subcategory.name }}</strong>
              </div>
            </td>
            <td>
              <div class="description-cell">
                {{ subcategory.description | slice:0:50 }}{{ subcategory.description?.length > 50 ? '...' : '' }}
              </div>
            </td>
            <td>
              <p-tag 
                [value]="getCategoryName(subcategory.categoryId)" 
                severity="info">
              </p-tag>
            </td>
            <td>
              <p-tag 
                [value]="subcategory.isActive ? 'Active' : 'Inactive'" 
                [severity]="subcategory.isActive ? 'success' : 'danger'">
              </p-tag>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-eye" 
                  class="p-button-text p-button-sm"
                  pTooltip="View Products"
                  (click)="viewProducts(subcategory)">
                </button>
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-pencil" 
                  class="p-button-text p-button-sm"
                  pTooltip="Edit"
                  (click)="openEditDialog(subcategory)">
                </button>
                <button 
                  pButton 
                  type="button" 
                  icon="pi pi-trash" 
                  class="p-button-text p-button-sm p-button-danger"
                  pTooltip="Delete"
                  (click)="deleteSubcategory(subcategory)">
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center">
              <div class="empty-state">
                <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                <p>No subcategories found</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>

  <!-- Add/Edit Dialog -->
  <p-dialog 
    [visible]="displayDialog" 
    [modal]="true" 
    [closable]="true"
    [style]="{width: '600px'}"
    [header]="isEditMode ? 'Edit Subcategory' : 'Add Subcategory'"
    (onHide)="onCancel()">
    
    <form [formGroup]="subcategoryForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <div class="form-group">
          <label for="name">Name *</label>
          <input 
            type="text" 
            id="name"
            pInputText 
            formControlName="name"
            placeholder="Enter subcategory name"
            class="w-full">
          <small 
            *ngIf="subcategoryForm.get('name')?.invalid && subcategoryForm.get('name')?.touched" 
            class="p-error">
            Name is required and must be at least 2 characters
          </small>
        </div>

        <div class="form-group">
          <label for="categoryId">Category *</label>
          <p-select 
            id="categoryId"
            [options]="categories" 
            optionLabel="name" 
            optionValue="id"
            placeholder="Select Category"
            formControlName="categoryId"
            class="w-full">
          </p-select>
          <small 
            *ngIf="subcategoryForm.get('categoryId')?.invalid && subcategoryForm.get('categoryId')?.touched" 
            class="p-error">
            Category is required
          </small>
        </div>

        <div class="form-group full-width">
          <label for="description">Description *</label>
          <textarea 
            id="description"
            pInputTextarea 
            formControlName="description"
            placeholder="Enter subcategory description"
            rows="3"
            class="w-full">
          </textarea>
          <small 
            *ngIf="subcategoryForm.get('description')?.invalid && subcategoryForm.get('description')?.touched" 
            class="p-error">
            Description is required and must be at least 10 characters
          </small>
        </div>

        <div class="form-group">
          <label for="image">Image</label>
          <div class="image-upload-section">
            <input 
              type="file" 
              id="image"
              accept="image/*" 
              (change)="onFileSelected($event)"
              class="file-input">
            <label for="image" class="file-label">
              <i class="pi pi-upload"></i>
              Choose Image
            </label>
            <div *ngIf="imagePreview" class="image-preview">
              <img [src]="imagePreview" alt="Preview">
              <button 
                type="button" 
                pButton 
                icon="pi pi-times" 
                class="p-button-text p-button-sm remove-image-btn"
                (click)="removeImage()">
              </button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <p-checkbox 
              formControlName="isActive" 
              [binary]="true"
              inputId="isActive">
            </p-checkbox>
            <label for="isActive">Active</label>
          </div>
        </div>
      </div>

      <div class="dialog-actions">
        <button 
          type="button" 
          pButton 
          label="Cancel" 
          class="p-button-text"
          (click)="onCancel()">
        </button>
        <button 
          type="submit" 
          pButton 
          [label]="isEditMode ? 'Update' : 'Create'"
          class="p-button-primary"
          [disabled]="subcategoryForm.invalid">
        </button>
      </div>
    </form>
  </p-dialog>
</div>
